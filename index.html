<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Database</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div id="root"></div>

    <!-- React and ReactDOM from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Replace this with your actual OMDB API key.
        const API_KEY = "YOUR_API_KEY_HERE";

        const App = () => {
          const [movies, setMovies] = useState([]);
          const [searchTerm, setSearchTerm] = useState('');
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);
          const [selectedMovie, setSelectedMovie] = useState(null);
          const [favorites, setFavorites] = useState([]);
          const [showFavorites, setShowFavorites] = useState(false);
        
          useEffect(() => {
            // Load favorites from localStorage on initial render
            const storedFavorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            setFavorites(storedFavorites);
          }, []);
        
          const fetchMovies = async (query) => {
            if (!query) return;
            setLoading(true);
            setError(null);
            try {
              const response = await fetch(`https://www.omdbapi.com/?s=${query}&apikey=${API_KEY}`);
              const data = await response.json();
              if (data.Response === 'True') {
                setMovies(data.Search);
              } else {
                setMovies([]);
                setError(data.Error);
              }
            } catch (err) {
              setError('Failed to fetch movies. Please check your network connection.');
              setMovies([]);
            } finally {
              setLoading(false);
            }
          };
        
          const fetchMovieDetails = async (imdbID) => {
            setLoading(true);
            setError(null);
            try {
              const response = await fetch(`https://www.omdbapi.com/?i=${imdbID}&plot=full&apikey=${API_KEY}`);
              const data = await response.json();
              if (data.Response === 'True') {
                setSelectedMovie(data);
              } else {
                setError(data.Error);
              }
            } catch (err) {
              setError('Failed to fetch movie details. Please try again.');
            } finally {
              setLoading(false);
            }
          };
        
          const handleSearch = (e) => {
            e.preventDefault();
            setSelectedMovie(null);
            setShowFavorites(false);
            fetchMovies(searchTerm);
          };
        
          const handleMovieClick = (imdbID) => {
            fetchMovieDetails(imdbID);
          };
        
          const handleAddToFavorites = (movie) => {
            const newFavorites = [...favorites, movie];
            setFavorites(newFavorites);
            localStorage.setItem('favorites', JSON.stringify(newFavorites));
          };
        
          const handleRemoveFromFavorites = (imdbID) => {
            const newFavorites = favorites.filter(movie => movie.imdbID !== imdbID);
            setFavorites(newFavorites);
            localStorage.setItem('favorites', JSON.stringify(newFavorites));
          };
        
          const isFavorite = (imdbID) => {
            return favorites.some(movie => movie.imdbID === imdbID);
          };
        
          const renderStars = (rating) => {
            if (!rating || isNaN(rating) || rating === "N/A") {
              return null;
            }
            const fullStars = Math.round(parseFloat(rating) / 2);
            const stars = [];
            for (let i = 0; i < 5; i++) {
              stars.push(
                <svg
                  key={i}
                  className={`h-5 w-5 ${i < fullStars ? 'text-yellow-400' : 'text-gray-400'}`}
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.461a1 1 00.95-.69l1.07-3.292z" />
                </svg>
              );
            }
            return <div className="flex items-center space-x-1">{stars}</div>;
          };
        
          const renderContent = () => {
            if (loading) {
              return (
                <div className="flex justify-center items-center h-full text-white">
                  <svg className="animate-spin h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </div>
              );
            }
            if (error) {
              return <div className="text-red-400 text-center mt-8 text-xl font-medium">{error}</div>;
            }
        
            if (showFavorites) {
              if (favorites.length === 0) {
                return <div className="text-gray-400 text-center mt-8 text-xl">You don't have any favorite movies yet.</div>;
              }
              return (
                <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 mt-8 p-4">
                  {favorites.map((movie) => (
                    <div
                      key={movie.imdbID}
                      className="bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105 cursor-pointer"
                    >
                      <img
                        src={movie.Poster !== 'N/A' ? movie.Poster : 'https://placehold.co/300x450/1e293b/a5b4fc?text=No+Poster'}
                        alt={movie.Title}
                        className="w-full h-auto object-cover rounded-t-lg"
                      />
                      <div className="p-4 text-center">
                        <h3 className="text-white font-semibold text-lg truncate">{movie.Title}</h3>
                        <p className="text-gray-400 text-sm">{movie.Year}</p>
                      </div>
                    </div>
                  ))}
                </div>
              );
            }
        
            if (selectedMovie) {
              return (
                <div className="mt-8 flex flex-col md:flex-row items-center md:items-start p-4 bg-gray-800 rounded-lg shadow-2xl space-y-6 md:space-y-0 md:space-x-8">
                  <div className="w-full md:w-1/3 flex-shrink-0">
                    <img
                      src={selectedMovie.Poster !== 'N/A' ? selectedMovie.Poster : 'https://placehold.co/300x450/1e293b/a5b4fc?text=No+Poster'}
                      alt={selectedMovie.Title}
                      className="w-full rounded-lg shadow-xl object-cover"
                    />
                  </div>
                  <div className="w-full md:w-2/3 text-gray-200 space-y-4">
                    <div className="flex justify-between items-start">
                      <h2 className="text-3xl font-bold text-white leading-tight">{selectedMovie.Title} <span className="text-gray-400 font-normal">({selectedMovie.Year})</span></h2>
                      <button
                        onClick={() => isFavorite(selectedMovie.imdbID) ? handleRemoveFromFavorites(selectedMovie.imdbID) : handleAddToFavorites(selectedMovie)}
                        className="p-2 rounded-full transition-colors duration-200"
                      >
                        <svg className={`h-8 w-8 ${isFavorite(selectedMovie.imdbID) ? 'text-red-500' : 'text-gray-500'} hover:text-red-400 transition-colors`} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5A5.5 5.5 0 017.5 3c1.74 0 3.41.81 4.5 2.09A5.5 5.5 0 0116.5 3c3.03 0 5.5 2.47 5.5 5.5 0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                      </button>
                    </div>
                    <p className="text-gray-400 italic text-base">{selectedMovie.Genre}</p>
                    <p className="text-lg font-medium">{selectedMovie.Plot}</p>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                      <p><strong>Director:</strong> {selectedMovie.Director}</p>
                      <p><strong>Writer:</strong> {selectedMovie.Writer}</p>
                      <p><strong>Actors:</strong> {selectedMovie.Actors}</p>
                      <p><strong>Awards:</strong> {selectedMovie.Awards}</p>
                      <p><strong>Runtime:</strong> {selectedMovie.Runtime}</p>
                      <p><strong>Box Office:</strong> {selectedMovie.BoxOffice}</p>
                    </div>
                    {selectedMovie.Ratings && selectedMovie.Ratings.length > 0 && (
                      <div className="pt-4">
                        <h3 className="text-lg font-semibold text-white mb-2">Ratings</h3>
                        <div className="flex flex-wrap gap-4">
                          {selectedMovie.Ratings.map((rating, index) => (
                            <div key={index} className="bg-gray-700 p-3 rounded-lg flex flex-col items-center">
                              <p className="text-sm font-semibold text-yellow-300">{rating.Value}</p>
                              <p className="text-xs text-gray-400">{rating.Source}</p>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                    <button
                      onClick={() => setSelectedMovie(null)}
                      className="mt-6 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-full shadow-lg transition-colors duration-200"
                    >
                      Back to Results
                    </button>
                  </div>
                </div>
              );
            }
            
            if (movies.length === 0 && searchTerm !== '') {
                return <div className="text-gray-400 text-center mt-8 text-xl">No movies found for "{searchTerm}".</div>;
            }
        
            return (
              <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 mt-8 p-4">
                {movies.map((movie) => (
                  <div
                    key={movie.imdbID}
                    onClick={() => handleMovieClick(movie.imdbID)}
                    className="bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105 cursor-pointer"
                  >
                    <img
                      src={movie.Poster !== 'N/A' ? movie.Poster : 'https://placehold.co/300x450/1e293b/a5b4fc?text=No+Poster'}
                      alt={movie.Title}
                      className="w-full h-auto object-cover rounded-t-lg"
                    />
                    <div className="p-4 text-center">
                      <h3 className="text-white font-semibold text-lg truncate">{movie.Title}</h3>
                      <p className="text-gray-400 text-sm">{movie.Year}</p>
                    </div>
                  </div>
                ))}
              </div>
            );
          };
        
          return (
            <div className="min-h-screen bg-gray-900 font-sans text-gray-200 p-4 sm:p-8">
              <header className="flex flex-col sm:flex-row justify-between items-center mb-8">
                <h1 className="text-3xl sm:text-4xl font-extrabold text-indigo-500 mb-4 sm:mb-0">Movie Database</h1>
                <nav className="flex space-x-4">
                  <button
                    onClick={() => { setSelectedMovie(null); setShowFavorites(false); }}
                    className="text-gray-300 hover:text-white transition-colors duration-200 font-medium"
                  >
                    Home
                  </button>
                  <button
                    onClick={() => { setSelectedMovie(null); setShowFavorites(true); }}
                    className="text-gray-300 hover:text-white transition-colors duration-200 font-medium"
                  >
                    Favorites
                  </button>
                </nav>
              </header>
              
              {!selectedMovie && !showFavorites && (
                <form onSubmit={handleSearch} className="flex items-center w-full max-w-2xl mx-auto rounded-full bg-gray-800 p-2 shadow-lg transition-shadow duration-200 hover:shadow-xl focus-within:ring-2 ring-indigo-500">
                  <input
                    type="text"
                    placeholder="Search for a movie..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full bg-transparent text-white placeholder-gray-400 px-4 py-2 outline-none"
                  />
                  <button
                    type="submit"
                    className="p-3 bg-indigo-600 rounded-full text-white hover:bg-indigo-700 transition-colors duration-200"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5">
                      <path fillRule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.085l3.58 3.58a1 1 0 11-1.414 1.414l-3.58-3.58A7 7 0 012 9z" clipRule="evenodd" />
                    </svg>
                  </button>
                </form>
              )}
        
              {renderContent()}
            </div>
          );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
