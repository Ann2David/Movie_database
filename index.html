<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Database</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .text-2xl .star {
            font-size: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-4 sm:p-8 min-h-screen">
    <div class="container mx-auto">
        <header class="flex flex-col md:flex-row items-center justify-between py-4">
            <h1 class="text-3xl font-bold text-gray-100 mb-4 md:mb-0">Movie Database</h1>
            <div class="flex space-x-4">
                <button id="home-button" class="font-semibold text-lg transition-colors duration-300 text-purple-400 hover:text-purple-400">Home</button>
                <button id="favorites-button" class="font-semibold text-lg transition-colors duration-300 text-gray-400 hover:text-purple-400">Favorites</button>
            </div>
        </header>

        <div class="mb-8" id="search-container">
            <form id="search-form">
                <div class="flex rounded-full overflow-hidden shadow-lg bg-gray-800 focus-within:ring-2 focus-within:ring-purple-500 transition-all duration-300">
                    <input type="text" id="search-input" class="flex-1 px-6 py-3 bg-transparent text-gray-200 placeholder-gray-500 focus:outline-none" placeholder="Search for a movie...">
                    <button type="submit" class="bg-purple-600 text-white px-6 py-3 flex items-center justify-center transition-colors duration-300 hover:bg-purple-700 focus:outline-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 112 0 16 0A6 6 0 012 8zm13.707 5.707a1 1 0 00-1.414-1.414L11.586 14 13.707 16.121a1 1 0 001.414-1.414L13.414 14.586a1 1 0 001.414-1.414z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </form>
        </div>

        <div id="content-area" class="min-h-[50vh]">
            <div class="text-center text-gray-400 mt-16">Start by searching for a movie!</div>
        </div>

        <footer class="mt-16 text-center text-gray-500 text-sm">
            <p>© 2025 Movie Database. Data provided by TMDb.</p>
        </footer>
    </div>

    <script>
        const TMDB_API_KEY = "a155eedb6bc34341377728cf349adac0";
        const TMDB_BASE_URL = "https://api.themoviedb.org/3";
        const TMDB_IMAGE_URL = "https://image.tmdb.org/t/p/w500";
        const TMDB_PLACEHOLDER_IMAGE = "https://placehold.co/500x750/1f2937/9ca3af?text=Image+Not+Found";

        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const contentArea = document.getElementById('content-area');
        const homeButton = document.getElementById('home-button');
        const favoritesButton = document.getElementById('favorites-button');

        let currentView = 'home';
        let currentMovies = [];
        let favorites = JSON.parse(localStorage.getItem('movie-favorites')) || [];
        let selectedMovie = null;

        const saveFavorites = () => {
            localStorage.setItem('movie-favorites', JSON.stringify(favorites));
        };

        const setLoadingState = (message) => {
            contentArea.innerHTML = `<div class="text-center text-gray-400 mt-16">${message}</div>`;
        };

        const setErrorState = (message) => {
            contentArea.innerHTML = `<div class="text-center text-red-500 mt-16">${message}</div>`;
        };

        const renderHomeView = () => {
            homeButton.classList.add('text-purple-400');
            favoritesButton.classList.remove('text-purple-400');
            
            if (currentMovies.length === 0) {
                contentArea.innerHTML = `<div class="text-center text-gray-400 mt-16">Start by searching for a movie!</div>`;
                return;
            }

            contentArea.innerHTML = `
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6 mt-8">
                    ${currentMovies.map(movie => `
                        <div
                            class="bg-gray-800 rounded-xl overflow-hidden shadow-lg transform transition-transform duration-300 hover:scale-105 cursor-pointer movie-card"
                            data-movie-id="${movie.id}"
                            data-movie-data='${JSON.stringify(movie)}'
                        >
                            <img
                                src="${movie.poster_path ? `${TMDB_IMAGE_URL}${movie.poster_path}` : TMDB_PLACEHOLDER_IMAGE}"
                                alt="${movie.title}"
                                class="w-full h-auto object-cover"
                            />
                            <div class="p-4 text-center">
                                <h3 class="text-sm font-semibold text-white">${movie.title}</h3>
                                <p class="text-xs text-gray-400 mt-1">${movie.release_date ? movie.release_date.substring(0, 4) : 'N/A'}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            attachMovieCardListeners();
        };

        const renderFavoritesView = () => {
            homeButton.classList.remove('text-purple-400');
            favoritesButton.classList.add('text-purple-400');

            if (favorites.length === 0) {
                contentArea.innerHTML = `<div class="text-center text-gray-400 mt-8">Your favorites list is empty.</div>`;
                return;
            }

            contentArea.innerHTML = `
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6 mt-8">
                    ${favorites.map(movie => `
                        <div
                            class="bg-gray-800 rounded-xl overflow-hidden shadow-lg transform transition-transform duration-300 hover:scale-105 cursor-pointer relative group"
                            data-movie-id="${movie.id}"
                            data-movie-data='${JSON.stringify(movie)}'
                        >
                            <img
                                src="${movie.poster_path ? `${TMDB_IMAGE_URL}${movie.poster_path}` : TMDB_PLACEHOLDER_IMAGE}"
                                alt="${movie.title}"
                                class="w-full h-auto object-cover"
                            />
                            <div class="absolute top-2 right-2 p-2 bg-red-600 rounded-full cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity remove-favorite-btn" data-movie-id="${movie.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="p-4 text-center">
                                <h3 class="text-sm font-semibold text-white">${movie.title}</h3>
                                <p class="text-xs text-gray-400 mt-1">${movie.release_date ? movie.release_date.substring(0, 4) : 'N/A'}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            attachMovieCardListeners();
            attachRemoveFavoriteListeners();
        };

        const renderDetailsView = () => {
            if (!selectedMovie) {
                renderHomeView();
                return;
            }

            const isFavorite = favorites.some(fav => fav.id === selectedMovie.id);
            const genres = selectedMovie.genres ? selectedMovie.genres.map(g => `<span class="mr-2">${g.name}</span>`).join('') : '';
            const cast = selectedMovie.credits.cast ? selectedMovie.credits.cast.slice(0, 5).map(person => `<span class="bg-gray-700 px-3 py-1 rounded-full">${person.name}</span>`).join('') : '';
            const ratingStars = '★'.repeat(Math.round(selectedMovie.vote_average / 2));
            const emptyStars = '★'.repeat(5 - Math.round(selectedMovie.vote_average / 2));

            contentArea.innerHTML = `
                <div class="flex flex-col md:flex-row bg-gray-800 rounded-xl shadow-2xl p-6 mt-8 md:mt-16">
                    <div class="md:w-1/3 flex-shrink-0">
                        <img
                            src="${selectedMovie.poster_path ? `${TMDB_IMAGE_URL}${selectedMovie.poster_path}` : TMDB_PLACEHOLDER_IMAGE}"
                            alt="${selectedMovie.title}"
                            class="w-full h-auto rounded-lg shadow-lg"
                        />
                    </div>
                    <div class="md:ml-8 mt-6 md:mt-0 flex-1">
                        <h1 class="text-4xl font-bold text-white mb-2">${selectedMovie.title} (${selectedMovie.release_date ? selectedMovie.release_date.substring(0, 4) : 'N/A'})</h1>
                        <div class="flex flex-wrap items-center text-gray-400 text-sm italic mb-4">
                            ${genres}
                        </div>

                        <div class="flex items-center mb-4">
                            <span class="text-yellow-400 text-2xl">${ratingStars}</span>
                            <span class="text-gray-500 text-2xl">${emptyStars}</span>
                            <span class="text-gray-400 text-sm ml-2">(${selectedMovie.vote_count} votes)</span>
                        </div>

                        <h2 class="text-xl font-semibold text-gray-200 mb-2">Overview</h2>
                        <p class="text-gray-300 leading-relaxed mb-6">${selectedMovie.overview}</p>

                        <h2 class="text-xl font-semibold text-gray-200 mb-2">Cast</h2>
                        <div class="flex flex-wrap gap-2 text-sm text-gray-400 mb-6">
                            ${cast}
                        </div>

                        <button id="favorite-toggle-btn" class="${isFavorite ? 'bg-red-600 hover:bg-red-700' : 'bg-purple-600 hover:bg-purple-700'} text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 focus:outline-none">
                            ${isFavorite ? 'Remove from Favorites' : 'Add to Favorites'}
                        </button>
                    </div>
                </div>
            `;
            attachFavoriteToggleListener();
        };

        const fetchMovies = async (title) => {
            setLoadingState("Searching for movies...");
            try {
                const response = await fetch(`${TMDB_BASE_URL}/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(title)}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                if (data.results && data.results.length > 0) {
                    currentMovies = data.results;
                    renderHomeView();
                } else {
                    currentMovies = [];
                    setErrorState("No movies found with that title.");
                }
            } catch (err) {
                console.error("Failed to fetch movies:", err);
                setErrorState("Failed to fetch movies. Please check your network connection.");
            }
        };

        const fetchMovieDetails = async (id) => {
            setLoadingState("Loading movie details...");
            try {
                const response = await fetch(`${TMDB_BASE_URL}/movie/${id}?api_key=${TMDB_API_KEY}&append_to_response=credits`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                selectedMovie = data;
                renderDetailsView();
            } catch (err) {
                console.error("Failed to fetch movie details:", err);
                setErrorState("Failed to fetch movie details. Please try again later.");
            }
        };
        
        const attachMovieCardListeners = () => {
            document.querySelectorAll('.movie-card').forEach(card => {
                card.addEventListener('click', (event) => {
                    const movieId = card.dataset.movieId;
                    fetchMovieDetails(movieId);
                });
            });
        };

        const attachRemoveFavoriteListeners = () => {
            document.querySelectorAll('.remove-favorite-btn').forEach(btn => {
                btn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const movieId = parseInt(btn.dataset.movieId);
                    favorites = favorites.filter(fav => fav.id !== movieId);
                    saveFavorites();
                    renderFavoritesView();
                });
            });
        };

        const attachFavoriteToggleListener = () => {
            const btn = document.getElementById('favorite-toggle-btn');
            if (btn) {
                btn.addEventListener('click', () => {
                    if (!selectedMovie) return;
                    const isFavorite = favorites.some(fav => fav.id === selectedMovie.id);
                    if (isFavorite) {
                        favorites = favorites.filter(fav => fav.id !== selectedMovie.id);
                    } else {
                        favorites.push(selectedMovie);
                    }
                    saveFavorites();
                    renderDetailsView(); 
                });
            }
        };

    
        homeButton.addEventListener('click', () => {
            currentView = 'home';
            renderHomeView();
        });

        favoritesButton.addEventListener('click', () => {
            currentView = 'favorites';
            renderFavoritesView();
        });

        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                currentView = 'home';
                fetchMovies(searchTerm);
            }
        });

        // Initial render
        renderHomeView();
    </script>
</body>
</html>
